/*
 * main.c
 *
 *  Created on: 07/06/2016
 *      Author: Red
 */

#include "LCD.h"
#include "RTC.h"
#include "KBD.h"
#include <stdio.h>
#include <string.h>

int pmain(){
	//todo
	/*
	if(!verifyFlash())
			resetFlash();
		//Copy sector 13 to Buffer
		//updateFlashBuffer();
	*/
	KBD_init(layout);
	LED_init(8, 0);
	//TMR0_Init(1000);
	SPI_Init(8,9);
	LCD_Init();
	//char time[time_len], date[date_len];
	//itot(time, 13, 50);
	//itod(date, 17, 1, 2016);
	int secs = 00, mins = 15, hours = 22, wdays = 1, days = 17, mons = 01, years = 2016, yday = 01;
	dateTime.tm_sec = secs;
	dateTime.tm_min = mins;
	dateTime.tm_hour = hours;
	dateTime.tm_wday = wdays;
	dateTime.tm_mday = days;
	dateTime.tm_mon = mons;
	dateTime.tm_year = years;
	dateTime.tm_yday = yday;
	RTC_Init(&dateTime);
	LCD_BL_State(0); //Apagar LCD light

	//uint32_t ptr[4]={10,11,12,13};

	//FLASH_EraseSectors(13,13);
	//FLASH_WriteBlock(sectorRegister, &ptr ,4*1024);

	LCD_TurnOffDisplay();

	int kbdValue;

	while(1){
		if( (kbdValue = KBD_read_nonBlocking()) != -1){
			if(kbdValue==doubleKey) runMaintenanceMode();
			else runNormalMode();
		}
	}

	return 0;
}


